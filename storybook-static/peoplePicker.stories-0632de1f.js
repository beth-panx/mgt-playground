import{e,f as t}from"./index-3a445c6b.js";import{h as o}from"./lit-html-c7682711.js";import{c as r,p as i,a as s,M as p,P as n,b as l,i as a}from"./Graph-3b72116e.js";import"./mgt-mock-provider-3678bf7a.js";import{r as c}from"./repeat-78423d92.js";const h=[r`:host([hidden]){display:none}:host{display:block;--default-font-family:"Segoe UI","Segoe UI Web (West European)","Segoe UI",-apple-system,BlinkMacSystemFont,Roboto,"Helvetica Neue",sans-serif;--theme-primary-color:#0078d7;--theme-dark-color:#005a9e}.ms-Icon{display:inline-block;font-family:FabricMDL2Icons;font-style:normal;font-weight:400;font-size:16px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;margin:4px 0}.ms-Icon--ChevronDown::before{content:"\\\E70D"}.ms-Icon--ChevronUp::before{content:"\\\E70E"}.ms-Icon--Contact::before{content:"\\\E77B"}.ms-Icon--AddFriend::before{content:"\\\E8FA"}.ms-Icon--OutlookLogoInverse::before{content:"\\\EB6D"}:host{border-radius:2px}:host .root,mgt-people-picker .root{display:block}:host .people-picker,mgt-people-picker .people-picker{position:relative;margin:7px 0 0 0;background-color:#fff;padding-bottom:8px}:host .people-list,mgt-people-picker .people-list{position:absolute;margin:7px 0 0 0;padding:0;box-shadow:0 1.3289px 2.65781px rgba(180,180,180,.182),0 1.3289px 2.65781px rgba(68,68,68,.3);border-radius:2px;background-color:var(--people-list-background-color,#fff);z-index:1;width:100%;text-align:left;list-style-type:none;font-family:Segoe UI;font-style:normal;font-weight:400}:host .people-list li,mgt-people-picker .people-list li{cursor:pointer}:host .people-list-separator,mgt-people-picker .people-list-separator{margin:var(--separator-margin,0 0 0 0);height:2px;background:var(--accent-color,#0078d4);margin-top:5px;text-align:center}:host .people-chosen-input,mgt-people-picker .people-chosen-input{position:relative;border:none;line-height:normal;outline:0;font-family:Segoe UI;font-style:normal;font-weight:400;font-size:14px;line-height:19px}:host .people-chosen-list,mgt-people-picker .people-chosen-list{display:flex;flex-wrap:wrap;vertical-align:middle;margin:0 0 0 0;list-style-type:none;padding-left:10px;font-family:Segoe UI;font-style:normal;font-weight:400}.CloseIcon,mgt-people-picker .CloseIcon{line-height:normal;font-family:FabricMDL2Icons;padding-right:8px;padding-left:4px;margin-top:0;cursor:pointer}:host .SearchIcon,mgt-people-picker .SearchIcon{font-family:FabricMDL2Icons;color:var(--accent-color,#0078d4)}:host .people-person,mgt-people-picker .people-person{display:flex;margin:4px 5px 0 0;align-items:center;background-color:rgba(196,196,196,.24);border-radius:15px;height:24px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}:host .list-person,mgt-people-picker .list-person{display:flex;flex-direction:row;flex-wrap:wrap;align-items:center;padding:12px;font-family:Segoe UI;font-style:normal;font-weight:600;font-size:14px}:host .list-person:hover,mgt-people-picker .list-person:hover{background-color:#f1f1f1dd}:host .people-person-list-fill,mgt-people-picker .people-person-list-fill{background-color:#f1f1f1}:host .people-person-text,mgt-people-picker .people-person-text{font-size:14px;font-weight:400;margin:0;padding:0}:host .input-search,mgt-people-picker .input-search{margin:7px 2px 0 3px}:host .input-search-start,mgt-people-picker .input-search-start{margin:7px 0 0 0;line-height:normal;margin-inline-start:0;margin-inline-end:0}:host .people-picker-input,mgt-people-picker .people-picker-input{display:flex;order:2;background-color:#fff;margin:var(--avatar-margin,0 4px 0 0);font-size:14px;line-height:19px;cursor:text}:host .duplicate-person,mgt-people-picker .duplicate-person{text-decoration:none;border-bottom:1px solid red}:host .remove-person-button,mgt-people-picker .remove-person-button{background:#767676;transform:matrix(-.71,-.71,.71,-.71,0,0)}:host .remove-person-button-secondary,mgt-people-picker .remove-person-button-secondary{background:#767676;transform:matrix(.71,-.71,.71,.71,0,0)}:host .person-display-name,mgt-people-picker .person-display-name{max-width:100px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-left:8px;font-family:Segoe UI;font-style:normal;font-weight:600;font-size:14px;line-height:19px;text-align:center;color:#000}mgt-person{--avatar-size-s:32px;margin-left:12px}.chosen-person{--avatar-size-s:24px;margin-left:0}:host .search-error-text,:host .loading-text,mgt-people-picker .search-error-text,mgt-people-picker .loading-text{font-family:Segoe UI;font-style:normal;font-weight:600;font-size:14px;line-height:19px;text-align:center;color:#232222}:host .SearchErrorIcon,mgt-people-picker .SearchErrorIcon{display:inline-block;font-family:FabricMDL2Icons;color:#cf0000}:host .message-parent,mgt-people-picker .message-parent{margin-top:30px;margin-bottom:30px;display:flex;align-items:center;justify-content:center;vertical-align:middle}:host .highlight-search-text,mgt-people-picker .highlight-search-text{font-weight:700}:host .people-person-job-title,mgt-people-picker .people-person-job-title{flex:100%;order:3;font-weight:400;font-size:12px;text-transform:uppercase}:host .people-person-text-area,mgt-people-picker .people-person-text-area{margin-left:13px;flex:1 1 0;max-height:40px}`];var d=function(e,t,o,r){var i,s=arguments.length,p=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)p=Reflect.decorate(e,t,o,r);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(p=(s<3?i(p):s>3?i(t,o,p):i(t,o))||p);return s>3&&p&&Object.defineProperty(t,o,p),p},g=function(e,t,o,r){return new(o||(o=Promise))(function(i,s){function p(e){try{l(r.next(e))}catch(e){s(e)}}function n(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(p,n)}l((r=r.apply(e,t||[])).next())})};let u=class extends p{constructor(){super(),this.people=null,this.showMax=6,this.selectedPeople=[],this._userInput="",this.arrowSelectionCount=0,this.isLoading=!1}static get styles(){return h}attributeChangedCallback(e,t,o){super.attributeChangedCallback(e,t,o),"group-id"===e&&t!==o&&this.findGroup()}firstUpdated(){this.groupId&&(n.onProviderUpdated(()=>this.findGroup()),this.findGroup())}render(){return this.renderTemplate("default",{people:this.people})||o` <div class="people-picker" @blur="${this.lostFocus}"> <div class="people-picker-input" @click="${this.gainedFocus}"> ${this.renderChosenPeople()} </div> <div class="people-list-separator"></div> ${this.renderPeopleList()} </div> `}focus(e){const t=this.renderRoot.querySelector(".people-chosen-input");t&&t.focus(e)}selectUsersById(e){return g(this,void 0,void 0,function*(){const t=n.globalProvider,o=n.globalProvider.graph;if(t&&t.state===l.SignedIn)for(const t in e)try{const r=yield o.getUser(e[t]);this.addPerson(r)}catch(e){}})}onUserKeyUp(e){if(40===e.keyCode||38===e.keyCode)return;const t=e.target;return"Escape"===e.code?(t.value="",this._userInput="",void(this.people=[])):"Backspace"===e.code&&0===this._userInput.length&&this.selectedPeople.length>0?(t.value="",this._userInput="",this.selectedPeople=this.selectedPeople.splice(0,this.selectedPeople.length-1),void this.fireCustomEvent("selectionChanged",this.selectedPeople)):void this.handleUserSearch(t)}findGroup(){return g(this,void 0,void 0,function*(){const e=n.globalProvider;if(e&&e.state===l.SignedIn){const e=n.globalProvider.graph;this.groupPeople=yield e.getPeopleFromGroup(this.groupId)}})}handleUserSearch(e){this.debouncedSearch||(this.debouncedSearch=a(()=>{this._userInput!==e.value&&(this._userInput=e.value,this.loadPersonSearch(this._userInput),this.arrowSelectionCount=0)},200)),this.debouncedSearch()}onUserKeyDown(e){40!==e.keyCode&&38!==e.keyCode||(this.handleArrowSelection(e),this._userInput.length>0&&e.preventDefault()),"Tab"!==e.code&&"Enter"!==e.code||(this.people.length&&e.preventDefault(),this.addPerson(this.people[this.arrowSelectionCount]),e.target.value="")}handleArrowSelection(e){if(this.people.length){38===e.keyCode&&(this.arrowSelectionCount>0?this.arrowSelectionCount--:this.arrowSelectionCount=0),40===e.keyCode&&(this.arrowSelectionCount+1!==this.people.length&&this.arrowSelectionCount+1<this.showMax?this.arrowSelectionCount++:this.arrowSelectionCount=0);const t=this.renderRoot.querySelector(".people-list");for(let e=0;e<t.children.length;e++)t.children[e].setAttribute("class","list-person people-person-list");t.children[this.arrowSelectionCount].setAttribute("class","list-person people-person-list-fill")}}addPerson(e){if(e){this._userInput="",0===this.selectedPeople.filter(t=>t.id===e.id).length&&(this.selectedPeople.push(e),this.fireCustomEvent("selectionChanged",this.selectedPeople),this.people=[])}this.gainedFocus()}loadPersonSearch(e){return g(this,void 0,void 0,function*(){if(e.length){e=e.toLowerCase();const t=n.globalProvider;let o;if(t&&t.state===l.SignedIn){const t=this;let r=!0;setTimeout(()=>{r&&(t.isLoading=!0)},400);const i=n.globalProvider.graph;(o=this.groupId?this.groupPeople:yield i.findPerson(e))&&(o=o.filter(t=>-1!==t.displayName.toLowerCase().indexOf(e))),this.people=this.filterPeople(o),r=!1,this.isLoading=!1}}else this.people=[]})}filterPeople(e){if(e){const t=this.selectedPeople.map(e=>e.id);return e.filter(e=>-1===t.indexOf(e.id))}}removePerson(e){const t=e,o=this.selectedPeople.filter(e=>e.id!==t.id);this.selectedPeople=o,this.fireCustomEvent("selectionChanged",this.selectedPeople)}renderErrorMessage(){return o` <div class="message-parent"> <div label="search-error-text" aria-label="We didn't find any matches." class="search-error-text"> We didn't find any matches. </div> </div> `}renderLoadingMessage(){return o` <div class="message-parent"> <div label="search-error-text" aria-label="loading" class="loading-text"> ...... </div> </div> `}renderChosenPeople(){let e,t="input-search-start";return this.selectedPeople.length>0?(t="input-search",e=o` ${this.selectedPeople.slice(0,this.selectedPeople.length).map(e=>o` <li class="people-person"> ${this.renderTemplate("person",{person:e},e.displayName)||this.renderChosenPerson(e)} <div class="CloseIcon" @click="${()=>this.removePerson(e)}">\uE711</div> </li> `)} `):e=null,o` <div class="people-chosen-list"> ${e} <div class="${t}"> <input id="people-picker-input" class="people-chosen-input" type="text" placeholder="Start typing a name" label="people-picker-input" aria-label="people-picker-input" role="input" .value="${this._userInput}" @keydown="${this.onUserKeyDown}" @keyup="${this.onUserKeyUp}"> </div> </div> `}gainedFocus(){const e=this.renderRoot.querySelector(".people-list"),t=this.renderRoot.querySelector(".people-chosen-input");t.focus(),t.select(),e&&e.setAttribute("style","display:block")}lostFocus(){const e=this.renderRoot.querySelector(".people-list");e&&e.setAttribute("style","display:none")}renderHighlightText(e){const t=e,r=t.displayName.toLowerCase().indexOf(this._userInput.toLowerCase());return-1!==r&&(0===r?(t.first="",t.highlight=t.displayName.slice(0,this._userInput.length),t.last=t.displayName.slice(this._userInput.length,t.displayName.length)):r===t.displayName.length?(t.first=t.displayName.slice(0,r),t.highlight=t.displayName.slice(r,t.displayName.length),t.last=""):(t.first=t.displayName.slice(0,r),t.highlight=t.displayName.slice(r,r+this._userInput.length),t.last=t.displayName.slice(r+this._userInput.length,t.displayName.length))),o` <div> <span class="people-person-text">${t.first}</span><span class="people-person-text highlight-search-text">${t.highlight}</span><span class="people-person-text">${t.last}</span> </div> `}renderPeopleList(){let e,t=this.people;return t&&(t=t.slice(0,this.showMax),this.isLoading?e=this.renderTemplate("loading",null,"loading")||this.renderLoadingMessage():0===t.length&&this._userInput.length>0?e=this.renderTemplate("error",null,"error")||this.renderErrorMessage():(t[0]&&(t[0].isSelected="fill"),e=this.renderPeople(t))),o` <div class="people-list"> ${e} </div> `}renderPeople(e){return o` ${c(e,e=>e.id,e=>o` <li class="list-person ${"fill"===e.isSelected?"people-person-list-fill":"people-person-list"}" @click="${()=>this.addPerson(e)}"> ${this.renderTemplate("person",{person:e},e.displayName)||this.renderPerson(e)} <div class="people-person-text-area" id="${e.displayName}"> ${this.renderHighlightText(e)} <span class="people-person-job-title">${e.jobTitle}</span> </div> </li> `)} `}renderPerson(e){return o` <mgt-person .personDetails="${e}" .personImage="${"@"}"></mgt-person> `}renderChosenPerson(e){return o` <mgt-person class="chosen-person" .personDetails="${e}" .personImage="${"@"}" show-name></mgt-person> `}};d([i({attribute:"people",type:Object})],u.prototype,"people",void 0),d([i({attribute:"show-max",type:Number})],u.prototype,"showMax",void 0),d([i({attribute:"group-id",type:String})],u.prototype,"groupId",void 0),d([i({attribute:"selected-people",type:Array})],u.prototype,"selectedPeople",void 0),d([i()],u.prototype,"_userInput",void 0),u=d([s("mgt-people-picker")],u);const m=()=>o` <mgt-mock-provider></mgt-mock-provider> <mgt-people-picker></mgt-people-picker> `;export default{title:"Mock Provider|mgt-people-picker",component:"mgt-people-picker",decorators:[e,t]};export{m as peoplePicker};
//# sourceMappingURL=peoplePicker.stories-0632de1f.js.map
